## loop-0387 red | helper:diff-snapshot=0 files changed
- command: |
    python3 - <<'PY'
    import os
    import subprocess
    import sys
    from pathlib import Path
    repo_root = Path(__file__).resolve().parents[1]
    marker = repo_root / 'artifacts' / 'telemetry' / 'talon-export-marker.json'
    marker.parent.mkdir(parents=True, exist_ok=True)
    if marker.exists():
        marker.unlink()
    result = subprocess.run(
        [sys.executable, 'scripts/tools/check-telemetry-export-marker.py', '--marker', str(marker)],
        text=True,
        capture_output=True,
        env={**os.environ, 'ALLOW_STALE_TELEMETRY': '1'}
    )
    if 'WARNING:' not in result.stderr:
        raise SystemExit('bypass warning missing')
    PY
- timestamp: 2025-12-23T17:10:45Z
- exit_status: 1
- output: |
    bypass warning missing

## loop-0387 green | helper:diff-snapshot=2 files changed, 2 insertions(+), 2 deletions(-)
- command: python3 -m pytest _tests/test_check_telemetry_export_marker.py
- timestamp: 2025-12-23T17:13:12Z
- exit_status: 0
- output: |
    ============================= test session starts ==============================
    collected 7 items
    
    _tests/test_check_telemetry_export_marker.py .......                     [100%]
    
    ============================== 7 passed in 2.26s ===============================

## loop-0387 removal | helper:diff-snapshot=0 files changed
- command: |
    git restore --source=HEAD -- _tests/test_check_telemetry_export_marker.py scripts/tools/check-telemetry-export-marker.py && python3 - <<'PY'
    import os
    import subprocess
    import sys
    from pathlib import Path
    repo_root = Path(__file__).resolve().parents[1]
    marker = repo_root / 'artifacts' / 'telemetry' / 'talon-export-marker.json'
    marker.parent.mkdir(parents=True, exist_ok=True)
    if marker.exists():
        marker.unlink()
    result = subprocess.run(
        [sys.executable, 'scripts/tools/check-telemetry-export-marker.py', '--marker', str(marker)],
        text=True,
        capture_output=True,
        env={**os.environ, 'ALLOW_STALE_TELEMETRY': '1'}
    )
    if 'WARNING:' not in result.stderr:
        raise SystemExit('bypass warning missing')
    PY
- timestamp: 2025-12-23T17:12:05Z
- exit_status: 1
- output: |
    bypass warning missing
