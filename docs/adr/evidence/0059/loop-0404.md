# loop-0404

- helper_version: helper:v20251223.1
- focus: ADR 0059 §Implementation Plan 1 — mute in-flight gating for passive overlay closes
- riskiest_assumption: close_common_overlays can suppress try_begin_request for passive runs without masking real conflicts; validated via targeted unit test forcing gating errors when the suppression flag is missing.
- validation_targets:
  - `python3 -m pytest _tests/test_overlay_lifecycle.py::OverlayLifecycleTests::test_common_overlay_closers_do_not_call_gating`
- evidence:
  - red | 2025-12-23T22:05:23Z | exit 1 | `python3 -m pytest _tests/test_overlay_lifecycle.py::OverlayLifecycleTests::test_common_overlay_closers_do_not_call_gating`
    - helper:diff-snapshot=0 files changed
    - pointer: inline — AssertionError because passive close invoked patched `_reject_if_request_in_flight` without suppression, showing existing gating behaviour.
  - green | 2025-12-23T22:23:03Z | exit 0 | `python3 -m pytest _tests/test_overlay_lifecycle.py::OverlayLifecycleTests::test_common_overlay_closers_do_not_call_gating`
    - helper:diff-snapshot=5 files changed, 75 insertions(+), 16 deletions(-)
    - pointer: inline — gating now short-circuits under passive suppression, allowing all closers to run without exercising the patched failure path.
- rollback_plan: `git restore --source=HEAD -- lib/overlayLifecycle.py lib/requestGating.py lib/modelHelpCanvas.py lib/modelPatternGUI.py _tests/test_overlay_lifecycle.py` && rerun the validation target to confirm the red behaviour reappears.
- delta_summary: helper:diff-snapshot=5 files changed, 75 insertions(+), 16 deletions(-) — added passive suppression flag to overlay lifecycle, early return in `try_begin_request`, helper guard in `modelHelpCanvas`, de-gated pattern close, and new unit test coverage.
- residual_risks:
  - Risk: Other overlays that call `_reject_if_request_in_flight` directly (outside close_common_overlays) might still emit in-flight drops if invoked automatically. Mitigation: audit remaining overlay entry points in subsequent loops; Trigger: telemetry still logging GUI sources after this change.
- next_work:
  - Behaviour: respect manual canvas visibility and refresh gating — `python3 -m pytest _tests/test_model_response_canvas.py` (Loop 2).
