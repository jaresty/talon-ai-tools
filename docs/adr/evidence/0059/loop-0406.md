# loop-0406

- helper_version: helper:v20251223.1
- focus: ADR 0059 §Implementation Plan 3 — skip disruptive refresh cycles when the canvas is already visible
- riskiest_assumption: Removing the hide/show cycle from `model_response_canvas_refresh` will keep redraw semantics intact without resetting the user’s scroll position; validated by a regression test that previously detected the hide call.
- validation_targets:
  - `python3 -m pytest _tests/test_model_response_canvas.py::ModelResponseCanvasTests::test_refresh_does_not_hide_when_showing`
  - `python3 -m pytest _tests/test_model_response_canvas.py`
- evidence:
  - red | 2025-12-23T22:44:00Z | exit 1 | `python3 -m pytest _tests/test_model_response_canvas.py::ModelResponseCanvasTests::test_refresh_does_not_hide_when_showing`
    - helper:diff-snapshot=0 files changed
    - pointer: inline — failure shows `dummy.hide_called` was `True`, confirming the legacy refresh path still hides the canvas and resets scroll.
  - green | 2025-12-23T22:45:28Z | exit 0 | `python3 -m pytest _tests/test_model_response_canvas.py::ModelResponseCanvasTests::test_refresh_does_not_hide_when_showing`
    - helper:diff-snapshot=2 files changed, 26 insertions(+), 2 deletions(-)
    - pointer: inline — hide is never invoked and scroll remains at 123.0, demonstrating the new behaviour.
  - green | 2025-12-23T22:45:35Z | exit 0 | `python3 -m pytest _tests/test_model_response_canvas.py`
    - helper:diff-snapshot=2 files changed, 26 insertions(+), 2 deletions(-)
    - pointer: inline — full response-canvas suite passes, ensuring broader functionality remains intact.
- rollback_plan: `git restore --source=HEAD -- lib/modelResponseCanvas.py _tests/test_model_response_canvas.py` && rerun the validation targets to reproduce the earlier failure and confirm rollback.
- delta_summary: helper:diff-snapshot=2 files changed, 26 insertions(+), 2 deletions(-) — removed the hide/show cycle, added regression coverage safeguarding scroll stability.
- residual_risks:
  - Risk: Other code paths (e.g., hide handlers) might still reset scroll unexpectedly. Mitigation: monitor user reports during subsequent loops; Trigger: telemetry or manual feedback indicating unexpected scroll jumps.
- next_work:
  - Behaviour: update send_request canvas refresh guard — `python3 -m pytest _tests/test_model_helpers_response_canvas.py::ResponseCanvasRefreshTests::test_refresh_uses_ui_dispatch` and related streaming integration coverage (Loop 4).
