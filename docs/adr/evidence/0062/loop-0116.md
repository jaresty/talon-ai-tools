- helper_version: helper:v20251223.1
- focus: ADR-0062 §Refactor Plan – History drawer passive guard alignment
- riskiest_assumption: History drawer close operations could continue to block during active streaming without shared allow_inflight handling (probability medium, impact medium on Concordance UX).
- validation_targets:
  - python3 -m pytest _tests/test_request_history_drawer.py
- evidence:
  - red | 2025-12-27T17:29:30Z | exit 1 | git stash push --keep-index --message loop-0116-red && python3 -m pytest _tests/test_request_history_drawer.py
    - helper:diff-snapshot=1 file changed, 12 insertions(+)
    - pointer: inline — new close guard test fails because guard_surface_request never receives allow_inflight when the drawer closes.
  - green | 2025-12-27T17:32:10Z | exit 0 | python3 -m pytest _tests/test_request_history_drawer.py
    - helper:diff-snapshot=2 files changed, 24 insertions(+), 4 deletions(-)
    - pointer: inline — suite passes with allow_inflight propagation and MagicMock-backed close coverage.
  - removal | 2025-12-27T17:33:00Z | exit 1 | git stash push --keep-index --message loop-0116-red && python3 -m pytest _tests/test_request_history_drawer.py
    - helper:diff-snapshot=1 file changed, 12 insertions(+)
    - pointer: inline — reverting module while keeping guard test reintroduces the missing allow flag.
- rollback_plan: git stash push --keep-index --message loop-0116-red && python3 -m pytest _tests/test_request_history_drawer.py && git stash pop && git reset _tests/test_request_history_drawer.py lib/requestHistoryDrawer.py
- delta_summary: helper:diff-snapshot=2 files changed, 24 insertions(+), 4 deletions(-); history drawer closers now delegate to surfaceGuidance with allow_inflight coverage.
- residual_risks:
  - Request history save actions still rely on bespoke drop handling; audit whether allow_inflight semantics are appropriate there.
- next_work:
  - Behaviour: review provider command gating for passive toggles — python3 -m pytest _tests/test_provider_commands.py — future-shaping: ensure administrative surfaces share the canonical guard contract.
