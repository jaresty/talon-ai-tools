# loop-0018 bootstrap installs packaged bar binary automatically

## metadata
- helper_version: helper:v20251223.1
- focus: Implementation Guardrails → Delivery posture — Salient task "Replace stubbed CLI delegation with real binary" (validation: `python3 - <<'PY'\nimport pathlib, sys\nbin_path = pathlib.Path('bin/bar.bin')\nif bin_path.exists():\n    bin_path.unlink()\nimport bootstrap\nbootstrap.bootstrap()\nif bin_path.exists():\n    sys.exit(0)\nraise SystemExit('bootstrap did not install CLI binary')\nPY`).
- riskiest_assumption: Without bootstrap invoking the installer, Talon startup on machines without a Go toolchain would leave `bin/bar.bin` missing until first CLI execution, keeping parity guardrails fragile.
- validation_targets:
  - `python3 - <<'PY'
import pathlib, sys
bin_path = pathlib.Path('bin/bar.bin')
if bin_path.exists():
    bin_path.unlink()
import bootstrap
bootstrap.bootstrap()
if bin_path.exists():
    sys.exit(0)
raise SystemExit('bootstrap did not install CLI binary')
PY`
- rollback_plan: `git restore --source=HEAD bootstrap.py scripts/tools/install_bar_cli.py && python3 scripts/tools/install_bar_cli.py --quiet`
- delta_summary: helper:diff-snapshot=4 files changed, 121 insertions(+), 11 deletions(-) — bootstrap installs CLI automatically before delegation
- loops_remaining_forecast:
  - 1 loop — Wire Talon adapter startup to reuse bootstrap install state and raise telemetry when installer fails (`python3 -m pytest _tests/test_cli_talon_parity.py`), confidence medium.
  - 2 loops — Publish signed artefacts + CI release checks (`scripts/tools/check_cli_assets.py`), confidence medium.
- residual_risks:
  - Signed artefacts still pending (severity medium). Mitigation: add signature enforcement + CI upload guard; monitor `scripts/tools/check_cli_assets.py` for checksum drift.
- next_work:
  - Behaviour: Replace stubbed CLI delegation with real binary — extend Talon bootstrap/adapters to surface installer failures via `python3 -m pytest _tests/test_cli_talon_parity.py`.
  - Behaviour: Release checksum manifest hardening — add signature validation to `scripts/tools/check_cli_assets.py` before CI publication.

## loop-0018 red | helper:rerun python3 - <<'PY'
import pathlib, sys
bin_path = pathlib.Path('bin/bar.bin')
if bin_path.exists():
    bin_path.unlink()
import bootstrap
bootstrap.bootstrap()
if bin_path.exists():
    sys.exit(0)
raise SystemExit('bootstrap did not install CLI binary')
PY
- 2026-01-02T21:22:43Z | exit 1
- helper:diff-snapshot=0 files changed
- failure: bootstrap left CLI binary missing; installer not invoked automatically | inline

```
bootstrap did not install CLI binary
```

## loop-0018 green | helper:rerun python3 - <<'PY'
import pathlib, sys
bin_path = pathlib.Path('bin/bar.bin')
if bin_path.exists():
    bin_path.unlink()
import bootstrap
bootstrap.bootstrap()
if bin_path.exists():
    sys.exit(0)
raise SystemExit('bootstrap did not install CLI binary')
PY
- 2026-01-02T21:27:26Z | exit 0
- helper:diff-snapshot=4 files changed, 121 insertions(+), 11 deletions(-)
- bootstrap installs packaged CLI binary automatically | inline

```
(no output)
```

## loop-0018 removal | helper:rerun python3 - <<'PY'
import pathlib, sys
bin_path = pathlib.Path('bin/bar.bin')
if bin_path.exists():
    bin_path.unlink()
import bootstrap
bootstrap.bootstrap()
if bin_path.exists():
    sys.exit(0)
raise SystemExit('bootstrap did not install CLI binary')
PY
- 2026-01-02T21:28:11Z | exit 1
- helper:diff-snapshot=0 files changed
- failure returns when bootstrap hooks removed | inline

```
bootstrap did not install CLI binary
```
