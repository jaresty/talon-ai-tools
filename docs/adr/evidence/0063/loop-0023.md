# loop-0023 surface bootstrap warnings in parity telemetry

## metadata
- helper_version: helper:v20251223.1
- focus: Implementation Guardrails → Delivery posture — Salient task "Replace stubbed CLI delegation with real binary" (validation: `python3 -m pytest _tests/test_cli_talon_parity.py`).
- riskiest_assumption: Without propagating bootstrap warnings into adapter telemetry, parity harness cannot detect when packaged CLI artefacts are missing.
- validation_targets:
  - `python3 -m pytest _tests/test_cli_talon_parity.py`
- rollback_plan: `git restore --source=HEAD bootstrap.py _tests/test_cli_talon_parity.py`
- delta_summary: helper:diff-snapshot=2 files changed, 74 insertions(+), 17 deletions(-) — capture bootstrap warnings, notify adapters, and assert within parity harness.
- loops_remaining_forecast:
  - 1 loop — Tie bootstrap warnings into adapter UI telemetry and parity reporting (`python3 -m pytest _tests/test_cli_talon_parity.py`), confidence medium.
  - 2 loops — Publish signed CLI artefacts with CI enforcement (`scripts/tools/check_cli_assets.py`), confidence medium.
- residual_risks:
  - Warnings still rely on stderr/notifications; no structured telemetry channel yet (severity medium). Mitigation: next slice routes warnings through adapters and parity, letting CI fail fast.
- next_work:
  - Behaviour: Replace stubbed CLI delegation with real binary — surface bootstrap warning telemetry through Talon adapters (`python3 -m pytest _tests/test_cli_talon_parity.py`).
  - Behaviour: Release checksum manifest hardening — add signature validation to `scripts/tools/check_cli_assets.py`.

## loop-0023 red | helper:rerun python3 -m pytest _tests/test_cli_talon_parity.py
- 2026-01-02T22:20:54Z | exit 1
- helper:diff-snapshot=0 files changed
- failure: parity harness stayed silent when packaged CLI manifest was missing | inline

```
============================= test session starts ==============================
platform darwin -- Python 3.11.14, pytest-8.2.1, pluggy-1.6.0
rootdir: /Users/tkma6d4/.talon/user/talon-ai-tools
configfile: pyproject.toml
collected 4 items

_tests/test_cli_talon_parity.py F.F.                                     [100%]

=================================== FAILURES ===================================
_____ CLITalonParityTests.test_bootstrap_warning_mentions_rebuild_command ______
self = <_tests.test_cli_talon_parity.CLITalonParityTests testMethod=test_bootstrap_warning_mentions_rebuild_command>
    def test_bootstrap_warning_mentions_rebuild_command(self) -> None:
        tarball = _packaged_cli_tarball()
        manifest = _packaged_cli_manifest(tarball)
        self.assertTrue(
            tarball.exists(),
            "Packaged CLI tarball missing; run `python3 scripts/tools/package_bar_cli.py --print-paths`.",
        )
        self.assertTrue(
            manifest.exists(),
            "Packaged CLI manifest missing; run `python3 scripts/tools/package_bar_cli.py --print-paths`.",
        )
        backup = manifest.read_bytes()
        try:
            manifest.unlink()
        except FileNotFoundError:
            pass
        get_bootstrap_warnings(clear=True)
        calls_before = list(actions.user.calls)
        try:
            buf = io.StringIO()
            with redirect_stderr(buf):
                bootstrap()
            warning_output = buf.getvalue()
            warnings = get_bootstrap_warnings(clear=True)
        finally:
            manifest.write_bytes(backup)
            bootstrap()
        new_calls = actions.user.calls[len(calls_before) :]
        del actions.user.calls[len(calls_before) :]
>       self.assertIn(
            "`python3 scripts/tools/package_bar_cli.py --print-paths`",
            warning_output,
            "Bootstrap warning must direct operators to rebuild packaged CLI",
        )
E       AssertionError: '`python3 scripts/tools/package_bar_cli.py --print-paths`' not found in '' : Bootstrap warning must direct operators to rebuild packaged CLI
```

## loop-0023 green | helper:rerun python3 -m pytest _tests/test_cli_talon_parity.py
- 2026-01-02T22:32:41Z | exit 0
- helper:diff-snapshot=2 files changed, 74 insertions(+), 17 deletions(-)
- success: parity harness now captures bootstrap warnings and notifies adapters | inline

```
============================= test session starts ==============================
platform darwin -- Python 3.11.14, pytest-8.2.1, pluggy-1.6.0
rootdir: /Users/tkma6d4/.talon/user/talon-ai-tools
configfile: pyproject.toml
collected 4 items

_tests/test_cli_talon_parity.py ....                                     [100%]
```

## loop-0023 removal | helper:rerun python3 -m pytest _tests/test_cli_talon_parity.py
- 2026-01-02T22:28:17Z | exit 1
- helper:diff-snapshot=0 files changed
- failure returns once bootstrap telemetry guard removed | inline

```
============================= test session starts ==============================
platform darwin -- Python 3.11.14, pytest-8.2.1, pluggy-1.6.0
rootdir: /Users/tkma6d4/.talon/user/talon-ai-tools
configfile: pyproject.toml
collected 4 items

_tests/test_cli_talon_parity.py F.F.                                     [100%]
```
