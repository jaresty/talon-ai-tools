# loop-0026 persist delegation telemetry and guard CLI wrapper

## metadata
- helper_version: helper:v20251223.1
- focus: Implementation Guardrails → Delivery posture — Salient task "Replace stubbed CLI delegation with real binary" (validation: `python3 -m pytest _tests/test_cli_talon_parity.py`).
- riskiest_assumption: If delegation disablement is not persisted and enforced at CLI launch, Talon will continue delegating to missing binaries after restart, silently violating delivery posture.
- validation_targets:
  - `python3 -m pytest _tests/test_cli_talon_parity.py`
- rollback_plan: `git restore --source=HEAD bin/bar lib/cliDelegation.py _tests/test_cli_talon_parity.py docs/adr/0063-go-cli-single-source-of-truth.work-log.md docs/adr/evidence/0063/loop-0026.md`
- delta_summary: helper:diff-snapshot=5 files changed, 136 insertions(+), 3 deletions(-) — persist delegation state, gate wrapper, and extend parity assertions.
- loops_remaining_forecast:
  - 1 loop — Feed delegation disablement into adapter health probes and automatic backoff counters (`python3 -m pytest _tests/test_cli_talon_parity.py`), confidence medium.
  - 2 loops — Wire delegation telemetry into CI plus offline bundle validation (`scripts/tools/check_cli_assets.py`), confidence medium.
- residual_risks:
  - Delegation state is local-only; distributed setups could desync between machines (severity medium). Mitigation: publish documentation for shared home setups and add CI check for stale state; monitor parity for unexpected residual warnings.
- next_work:
  - Behaviour: Replace stubbed CLI delegation with real binary — integrate adapter health probe failure counts with delegation state (`python3 -m pytest _tests/test_cli_talon_parity.py`).
  - Behaviour: Release checksum manifest hardening — surface delegation state within release guardrails (`scripts/tools/check_cli_assets.py`).

## loop-0026 red | helper:rerun python3 -m pytest _tests/test_cli_talon_parity.py
- 2026-01-03T00:12:10Z | exit 1
- helper:diff-snapshot=0 files changed
- failure: delegation state file missing when bootstrap disables CLI; parity assertion caught missing persistence | inline

```
E       AssertionError: unexpectedly None : Delegation state file should exist when bootstrap disables CLI
```

## loop-0026 green | helper:rerun python3 -m pytest _tests/test_cli_talon_parity.py
- 2026-01-03T00:12:42Z | exit 0
- helper:diff-snapshot=5 files changed, 135 insertions(+), 3 deletions(-)
- success: bootstrap now persists delegation state, CLI wrapper refuses to run when disabled, parity harness asserts persistence and re-enable semantics | inline

```
_tests/test_cli_talon_parity.py ....                                     [100%]
```

## loop-0026 removal | helper:rerun python3 -m pytest _tests/test_cli_talon_parity.py
- 2026-01-03T00:13:16Z | exit 1
- helper:diff-snapshot=0 files changed
- failure returns when persistence and wrapper guard are removed (delegation state still marked enabled) | inline

```
E           AssertionError: True is not false : Delegation state should mark CLI as disabled
```
