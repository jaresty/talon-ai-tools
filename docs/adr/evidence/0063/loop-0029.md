# loop-0029 surface CLI disable telemetry in guard/backoff notifications

## metadata
- helper_version: helper:v20251223.1
- focus: Implementation Guardrails → Delivery posture — surface CLI disable telemetry in adapter guard/backoff notifications (validation: `python3 -m pytest _tests/test_cli_talon_parity.py`).
- riskiest_assumption: Without propagating CLI disable telemetry into guard/backoff notifications, operators cannot distinguish delegation failures from other drops, leaving Talon gated loops to silently fall back and undermining the canonical CLI surface.
- validation_targets:
  - `python3 -m pytest _tests/test_cli_talon_parity.py`
- rollback_plan: `git restore --source=HEAD lib/dropReasonUtils.py _tests/test_cli_talon_parity.py` and rerun the parity suite to confirm the guard fails again.
- delta_summary: helper:diff-snapshot=2 files changed, 59 insertions(+), 1 deletion(-) — expose CLI disable telemetry via the drop-reason helper and assert guard/backoff coverage in parity tests.
- loops_remaining_forecast:
  - 1 loop — Persist delegation disable telemetry snapshots for release guardrails (`scripts/tools/check_cli_assets.py`), confidence medium.
  - 2 loops — Wire packaged asset telemetry into CI release contract with signature enforcement (`scripts/tools/check_cli_assets.py`), confidence medium.
- residual_risks:
  - Release guardrails still rely on manual inspection of CLI telemetry (severity medium). Mitigation: instrument `scripts/tools/check_cli_assets.py` with the disable snapshot and monitor bootstrap warning telemetry plus parity test `CLITalonParityTests::test_surface_guard_notifies_cli_failure_details` until automation lands.
- next_work:
  - Behaviour: Replace stubbed CLI delegation with real binary — emit disable snapshot artefacts consumed by release tooling (`python3 -m pytest _tests/test_cli_talon_parity.py`).
  - Behaviour: Harden release pipeline with checksum manifest — enforce delegation telemetry in `scripts/tools/check_cli_assets.py` guardrail (`scripts/tools/check_cli_assets.py`).

## loop-0029 red | helper:rerun python3 -m pytest _tests/test_cli_talon_parity.py
- 2026-01-03T02:59:10Z | exit 1
- helper:diff-snapshot=0 files changed
- failure: parity guard did not surface health probe counts in guard/backoff notifications | inline

```
>       self.assertIn(expected_probe_fragment, message)
E       AssertionError: 'failed probes=3/3' not found in 'GPT: CLI delegation disabled after failed health probes; rebuild the packaged CLI (`python3 scripts/tools/package_bar_cli.py --print-paths`) and rerun bootstrap before retrying.'

_tests/test_cli_talon_parity.py:383: AssertionError
```

## loop-0029 green | helper:rerun python3 -m pytest _tests/test_cli_talon_parity.py
- 2026-01-03T03:01:40Z | exit 0
- helper:diff-snapshot=2 files changed, 59 insertions(+), 1 deletion(-)
- success: parity suite passes with guard/backoff notifications showing CLI disable telemetry | inline

```
_tests/test_cli_talon_parity.py .......                                  [100%]
```

## loop-0029 removal | helper:rerun git restore --source=HEAD lib/dropReasonUtils.py _tests/test_cli_talon_parity.py && python3 -m pytest _tests/test_cli_talon_parity.py
- 2026-01-03T03:02:45Z | exit 1
- helper:diff-snapshot=0 files changed
- failure returns after restoring the pre-loop helper, confirming guard/backoff notifications lose telemetry | inline

```
>       self.assertIn(expected_probe_fragment, message)
E       AssertionError: 'failed probes=3/3' not found in 'GPT: CLI delegation disabled after failed health probes; rebuild the packaged CLI (`python3 scripts/tools/package_bar_cli.py --print-paths`) and rerun bootstrap before retrying.'

_tests/test_cli_talon_parity.py:383: AssertionError
```
