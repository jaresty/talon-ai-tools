# loop-0030 surface delegation telemetry in provider canvases

## metadata
- helper_version: helper:v20251223.1
- focus: Implementation Guardrails → Delivery posture — expose CLI delegation telemetry in provider registry/status canvases (validation: `python3 -m pytest _tests/test_provider_commands.py`).
- riskiest_assumption: Provider surfaces without CLI disable telemetry leave operators unaware of delegation fallback, risking silent drift from the canonical CLI surface during failures.
- validation_targets:
  - `python3 -m pytest _tests/test_provider_commands.py`
- rollback_plan: `git restore --source=HEAD lib/cliDelegation.py lib/providerCommands.py lib/providerRegistry.py lib/requestGating.py` then rerun the provider commands suite to confirm telemetry lines disappear.
- delta_summary: helper:diff-snapshot=6 files changed, 123 insertions(+), 12 deletions(-) — plumb delegation stats into registry outputs, render them, and add guardrail coverage.
- loops_remaining_forecast:
  - 1 loop — Persist delegation disable snapshots for release guardrails (`scripts/tools/check_cli_assets.py`), confidence medium.
  - 2 loops — Wire telemetry snapshots into CI release checks with signature enforcement (`scripts/tools/check_cli_assets.py`), confidence medium.
- residual_risks:
  - CLI disable snapshots are not yet persisted for release tooling (severity medium). Mitigation: next slice captures telemetry artefacts and adds release guard validation; monitor provider/status canvases for stale telemetry until then.
- next_work:
  - Behaviour: Replace stubbed CLI delegation with real binary — emit disable snapshot artefacts consumed by release tooling (`python3 -m pytest _tests/test_provider_commands.py`).
  - Behaviour: Harden release pipeline with checksum manifest — enforce delegation telemetry snapshot checks in `scripts/tools/check_cli_assets.py` (`scripts/tools/check_cli_assets.py`).

## loop-0030 red | helper:rerun python3 -m pytest _tests/test_provider_commands.py
- 2026-01-03T03:06:10Z | exit 1
- helper:diff-snapshot=0 files changed
- failure: provider status lines lacked delegation telemetry; new test asserted missing disabled status | inline

```
>       self.assertTrue(any("delegation: disabled" in line for line in lines))
E       AssertionError: False is not true

_tests/test_provider_commands.py:171: AssertionError
```

## loop-0030 green | helper:rerun python3 -m pytest _tests/test_provider_commands.py
- 2026-01-03T03:08:50Z | exit 0
- helper:diff-snapshot=6 files changed, 123 insertions(+), 12 deletions(-)
- success: provider command suite passes with delegation snapshot lines rendered and telemetry ratios present | inline

```
_tests/test_provider_commands.py .....                                   [100%]
```

## loop-0030 removal | helper:rerun git restore --source=HEAD lib/cliDelegation.py lib/providerCommands.py lib/providerRegistry.py lib/requestGating.py && python3 -m pytest _tests/test_provider_commands.py
- 2026-01-03T03:12:20Z | exit 1
- helper:diff-snapshot=0 files changed
- failure returns when delegation helpers revert to HEAD, confirming telemetry lines disappear from provider outputs | inline

```
>       self.assertTrue(any("delegation: disabled" in line for line in lines))
E       AssertionError: False is not true

_tests/test_provider_commands.py:171: AssertionError
```
