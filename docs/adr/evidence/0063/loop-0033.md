# loop-0033 bootstrap hydrates release delegation snapshot metadata

## metadata
- helper_version: helper:v20251223.1
- focus: Implementation Guardrails → Delivery posture — hydrate delegation snapshot metadata through bootstrap install (`python3 scripts/tools/check_cli_assets.py`).
- riskiest_assumption: Without hydrating the packaged delegation snapshot before running guardrails, releases could pass `check_cli_assets` while Talon still runs with stale or missing delegation metadata, leaving delegation disabled after install.
- validation_targets:
  - `python3 scripts/tools/check_cli_assets.py`
- rollback_plan: `git restore --source=HEAD lib/cliDelegation.py scripts/tools/install_bar_cli.py _tests/test_cli_talon_parity.py docs/adr/0063-go-cli-single-source-of-truth.work-log.md && rm docs/adr/evidence/0063/loop-0033.md` then rerun the validation command to confirm the guard fails without hydrated snapshots.
- delta_summary: helper:diff-snapshot=4 files changed, 291 insertions(+), 14 deletions(-) — merge delegation snapshots into bootstrap install, persist metadata in `cliDelegation`, extend install tooling, and add parity coverage with work-log updates.
- loops_remaining_forecast:
  - 1 loop — Wire bootstrap/install to surface signature enforcement blockers before parity (`python3 scripts/tools/check_cli_assets.py`), confidence medium.
  - 2 loops — Extend CI release flow to publish signed snapshot artefacts alongside binary (`python3 scripts/tools/check_cli_assets.py`), confidence medium.
- residual_risks:
  - Snapshot signatures are not yet verified in CI (severity medium). Mitigation: next loop integrates signature enforcement into `install_bar_cli.py` and guardrails; monitor `check_cli_assets` output in release automation.
- next_work:
  - Behaviour: Harden release pipeline with checksum manifest — add signature generation and CI upload validation for snapshot artefacts (`python3 scripts/tools/check_cli_assets.py`).
  - Behaviour: Replace stubbed CLI delegation with real binary — surface bootstrap/install failures through parity before Talon enables delegation (`python3 -m pytest _tests/test_cli_talon_parity.py`).

## loop-0033 red | helper:rerun python3 scripts/tools/check_cli_assets.py
- 2026-01-03T04:17:46.214597+00:00 | exit 1
- helper:diff-snapshot=0 files changed
- failure: guardrail reported missing runtime delegation state before bootstrap hydration | inline

```
missing delegation state: var/cli-telemetry/delegation-state.json
```

## loop-0033 green | helper:rerun python3 scripts/tools/check_cli_assets.py
- 2026-01-03T04:17:56.970102+00:00 | exit 0
- helper:diff-snapshot=4 files changed, 291 insertions(+), 14 deletions(-)
- success: guardrail passes after bootstrap hydrates runtime snapshot digest | inline

```
all CLI assets present
```

## loop-0033 removal | helper:rerun rm var/cli-telemetry/delegation-state.json && python3 scripts/tools/check_cli_assets.py
- 2026-01-03T04:18:08.454301+00:00 | exit 1
- helper:diff-snapshot=0 files changed
- failure returns when runtime snapshot is removed, confirming guard blocks unsigned installs | inline

```
missing delegation state: var/cli-telemetry/delegation-state.json
```
