# loop-0035 enforce delegation snapshot signatures in bootstrap and guardrails

## metadata
- helper_version: helper:v20251223.1
- focus: Implementation Guardrails → Delivery posture — enforce snapshot signature validation before parity (`python3 scripts/tools/check_cli_assets.py`).
- riskiest_assumption: Without verifying delegation snapshot signatures, releases could pass guardrails with tampered telemetry state, allowing Talon to delegate against altered metadata.
- validation_targets:
  - `python3 scripts/tools/check_cli_assets.py`
- rollback_plan: `git restore --source=HEAD scripts/tools/package_bar_cli.py scripts/tools/install_bar_cli.py scripts/tools/check_cli_assets.py _tests/test_check_cli_assets.py _tests/test_cli_talon_parity.py docs/adr/0063-go-cli-single-source-of-truth.work-log.md && rm docs/adr/evidence/0063/loop-0035.md && rm artifacts/cli/bar-darwin-arm64.tar.gz.sha256.sig artifacts/cli/delegation-state.json.sha256.sig && python3 -m pytest _tests/test_cli_talon_parity.py`
- delta_summary: helper:diff-snapshot=6 files changed, 161 insertions(+), 12 deletions(-) — add signature writers, verify signatures in bootstrap and guards, extend tests, and update work-log.
- loops_remaining_forecast:
  - 1 loop — Publish signed artefacts in CI and record upload verification (`python3 scripts/tools/check_cli_assets.py`), confidence medium.
  - 2 loops — Integrate real signing key management and telemetry for signature freshness (`python3 scripts/tools/check_cli_assets.py`), confidence medium.
- residual_risks:
  - Signing key remains static in-repo (severity medium). Mitigation: next slice sources key material from CI secrets and records telemetry when keys rotate.
- next_work:
  - Behaviour: Harden release pipeline with checksum manifest — automate signature generation in CI and extend guard to verify signed uploads (`python3 scripts/tools/check_cli_assets.py`).
  - Behaviour: Replace stubbed CLI delegation with real binary — surface bootstrap signature telemetry before enabling delegation (`python3 -m pytest _tests/test_cli_talon_parity.py`).

## loop-0035 red | helper:rerun python3 scripts/tools/check_cli_assets.py
- 2026-01-03T06:02:38Z | exit 1
- helper:diff-snapshot=0 files changed
- failure: guard reports missing delegation snapshot signature after manifest tampering | inline

```
missing delegation state signature: artifacts/cli/delegation-state.json.sha256.sig
```

## loop-0035 green | helper:rerun python3 scripts/tools/check_cli_assets.py
- 2026-01-03T06:03:23Z | exit 0
- helper:diff-snapshot=6 files changed, 161 insertions(+), 12 deletions(-)
- success: guard passes once snapshot signature is restored and verified | inline

```
all CLI assets present
```

## loop-0035 removal | helper:rerun python3 scripts/tools/check_cli_assets.py
- 2026-01-03T06:04:09Z | exit 1
- helper:diff-snapshot=0 files changed
- failure returns when the snapshot signature file is removed again, confirming guardrails block unsigned artefacts | inline

```
missing delegation state signature: artifacts/cli/delegation-state.json.sha256.sig
```
