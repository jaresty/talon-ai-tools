## metadata
- helper_version: helper:v20251223.1
- focus: Implementation Guardrails → Delivery posture — automate packaging retry on recovery snapshot drift (`python3 -m pytest _tests/test_check_cli_assets.py`)
- riskiest_assumption: If `check_cli_assets` stops after reporting recovery snapshot drift, CI operators must manually rerun packaging and telemetry stays stale, risking Talon delegating with outdated recovery prompts.
- validation_targets:
  - `python3 -m pytest _tests/test_check_cli_assets.py`
- rollback_plan: `git restore --source=HEAD scripts/tools/check_cli_assets.py _tests/test_check_cli_assets.py docs/adr/0063-go-cli-single-source-of-truth.work-log.md` then rerun the validation command to confirm the guard no longer auto-repackages.
- delta_summary: helper:diff-snapshot=4 files changed, 212 insertions(+), 1 deletion(-) — add automatic packaging flag in the guard, expose configurable command hook, extend tests, and update work-log + evidence.
- loops_remaining_forecast:
  - 1 loop — teach CI to publish the refreshed telemetry artefacts immediately after auto-packaging (`python3 scripts/tools/package_bar_cli.py --print-paths`), confidence medium.
  - 1 loop — document Talon operator remediation for recovery snapshot drift in parity UX (`python3 -m pytest _tests/test_cli_talon_parity.py`), confidence medium.
- residual_risks:
  - CI does not yet react to the guard’s auto-repackage output; without workflow integration, drift may persist (severity medium). Mitigation: invoke `python3 scripts/tools/package_bar_cli.py --print-paths` automatically in release pipelines and monitor guard output for repeated retries.
- next_work:
  - Behaviour: Harden release pipeline with checksum manifest — integrate CI upload flow to consume the refreshed telemetry bundle (`python3 scripts/tools/check_cli_assets.py`).

## loop-0049 red | helper:rerun python3 -m pytest _tests/test_check_cli_assets.py
- 2026-01-03T23:29:00Z | exit 1
- helper:diff-snapshot=2 files changed, 8 insertions(+), 0 deletions(-)
- failure: guard output lacks automatic packaging and telemetry path, new test fails | inline

```
E       AssertionError: 'cli_signature_telemetry=/var/.../signature-telemetry.json' not found in 'all CLI assets present\ncli_tarball=artifacts/cli/bar-darwin-arm64.tar.gz\ncli_manifest=artifacts/cli/bar-darwin-arm64.tar.gz.sha256\ncli_signatures=/var/.../signatures.json\n'
```

## loop-0049 green | helper:rerun python3 -m pytest _tests/test_check_cli_assets.py
- 2026-01-03T23:36:00Z | exit 0
- helper:diff-snapshot=4 files changed, 212 insertions(+), 1 deletion(-)
- success: guard automatically repackages, prints telemetry bundle, tests assert refreshed recovery snapshot | inline

```
_tests/test_check_cli_assets.py ................                         [100%]
```

## loop-0049 removal | helper:rerun git restore --source=HEAD scripts/tools/check_cli_assets.py && python3 -m pytest _tests/test_check_cli_assets.py
- 2026-01-03T23:38:00Z | exit 1
- helper:diff-snapshot=0 files changed
- failure returns after rollback: telemetry path and auto-repackage output missing again | inline

```
E       AssertionError: 'cli_signature_telemetry=/var/.../signature-telemetry.json' not found in ''
```
